# CRM система
Разработка CRM-системы на JavaScript

## Ссылки


* [Репозиторий](https://github.com/jenyakrutoy/crm)
* [Макет](https://www.figma.com/file/ueceZRRr6B5TQppVOPupNH/CRM-(Copy)?node-id=211%3A746&mode=dev)

## Используемые технологии
* JavaScript
* REST API
* Node.js
* Работа с сетью (протокол HTTP, формат данных JSON, Fetch API)
* HTML5
* Методология BEM
* CSS3, SCSS
* Flexbox
## Техническое задание
Разработать wеb-интерфейс для CRM системы, в которой должны быть следующие возможности:

* Просмотр списка клиентов в виде таблицы
* Добавление нового клиента
* Изменение информации о существующем клиенте

Каждый контакт представляет из себя следующий набор данных:

* Имя
* Фамилия
* Отчество
* Массив объектов с контактными данными, где каждый объект содержит:
  * Тип контакта (телефон, email, VK и т.п.)
  * Значение контакта (номер телефона, адрес email, ссылка на страницу в VK и т.п.)

Интерфейс представляет из себя единственную страницу, на которой располагается таблица клиентов, кнопка для добавления нового клиента, а также шапка с логотипом компании и строкой поиска клиентов.



## Описание компонентов и функционала приложения

### Таблица со списком клиентов
Таблица со списком людей имеет следующие колонки:
* ID
* ФИО (Фамилия Имя Отчество через пробел)
* Дата и время создания
* Дата и время последнего изменения
* Контакты
* Действия (кнопки)
  * Изменить клиента
  * Удалить клиента


При стартовой загрузке страницы происходит запрос к серверу и данные клиентов из сервера попадают в первичный массив клиентов. Таблица строится на основе данных из API.\
При первичной загрузке отображается индикатор загрузки, пока таблица с данными не будет построена.

### Поиск
В header-е находится форма поиска. Форма умеет подсвечивать совпадения клиентов в таблице.\
Также форма создает список автодополнения, в котором можно выбрать нужного клиента, после чего приложение плавно проскроллит страницу к выбранному клиенту.
При вводе текста в поле поиска, данные для таблицы перезапрашиваются из API в соответствии с введённым поисковым запросом. При этом запрос отправляется только по прошествии З00 миллисекунд с момента последнего ввода символа в поле.



### Сортировка
На все заголовки колонок, кроме контактов и действий, можно нажать, чтобы установить сортировку по соответствующему полю.\
Первое нажатие устанавливает сортировку по возрастанию, повторное - по убыванию.\
Сортировка происходит из JavaScript, то есть API передаёт данные
в неотсортированном виде.



### Отображение контактов клиента
В колонке с контактами, для контактов VK, Facebook, телефона и email отображаются соответствующие иконки. Bсe остальные виды контактов отображаются одинаковыми иконками с человечком.

При наведении указателя на контакт, показывается всплывающая подсказка с типом и значением этого контакта.

### Действия над клиентами
При нажатии на кнопку ***`Изменить`***, появляется модальное окно с формой
изменения клиента.
При нажатии на кнопку ***`Удалить`***, появляется модальное окно с подтверждением действия. Если пользователь подтверждает удаление, то клиент удаляется из списка. Также на сервер с API посылается запрос на удаление.


### Формы создания или редактирования данных о клиентах
Форма создания клиента открывается в виде модального окна при нажатии на кнопку ***`Добавить клиента`***, находящуюся под таблицей. Форма редактирования клиента открывается по нажатию на кнопку ***`Изменить`***, в таблице клиентов.
Форма создания клиента открывается сразу с незаполненными полями.

При изменении клиента, в списке клиентов запрашиваются данные нужного клиента, только после получения этих данных открывается модальное окно. Пока данные загружаются, отображается индикатор загрузки.


### Контакты клиента
В блоке контактов предусмотрена возможность добавления до 10 контактов включительно. Если у клиента уже добавлено 10 контактов, кнопка добавления контактов не отображается. Каждый контакт имеет селект слева и кнопку удаления справа.


### Кнопки
Под формой располагается кнопка ***`Сохранить`***. Кнопка ***`Удалить клиента`*** добавляется, если это форма редактирования существующего в базе данных человека.
При нажатии на кнопку удаления, клиент удаляется из таблицы, а на сервер API отправляется запрос на удаление клиента. Модальное окно с формой закрывается.

При нажатии на кнопку сохранения, изменения отправляются на сервер с использованием метода создания или изменения существующего клиента.


При нажатии на кнопку с крестиком, кнопку отмены или фон модального окна, модальное окно закрывается.

## Прочая инфраструктура приложения
* приложение адаптировано под различные разрешения экрана
* клиенты создаются с помощью класса
* каждому клиенту присваивается уникальный ID
* при открытии клиента - он получает уникальную ссылку в адресной строке браузера
* у клиентов сделана валидация формы. Запросы на сервер о добавлении / изменении клиента отправляются только после прохождения валидации.






## Краткая инструкция по работе

Для начала работы у Вас должент быть установлен **Node.js**



* находясь в директории **`crm-backend`**, запустите сервер командой - `node index`
* находясь в директории **`crm-frontend`**, запустите локальный Live Server



***




# REST API для базы данных клиентов

## Методы API

Все методы API, требующие тела запроса, ожидают получить тело в виде JSON. Ответы всех методов также отдаются в виде JSON.

* `GET /api/clients` получить список клиентов. Параметры, передаваемые в URL:
    * `search={search string}` поисковый запрос, при передаче метод вернёт клиентов, у которых имя, фамилия, отчество или значение одного из контактов содержат указанную подстроку
* `POST /api/clients` создать нового клиента. В теле запроса нужно передать объект клиента. Тело ответа успешно обработанного запроса будет содержать объект с созданным клиентом.
* `GET /api/client/{id}` получить данные клиента по его ID. Тело ответа успешно обработанного запроса будет содержать объект клиента.
* `PATCH /api/client/{id}` перезаписать данные о клиенте с переданным ID. Тело ответа успешно обработанного запроса будет содержать объект с обновлённым клиентом.
* `DELETE /api/client/{id}` удалить клиента с переданному ID.

## Структура объекта клиента

```javascript
{
  // ID клиента, заполняется сервером автоматически, после создания нельзя изменить
  id: '1234567890',
  // дата и время создания клиента, заполняется сервером автоматически, после создания нельзя изменить
  createdAt: '2021-02-03T13:07:29.554Z',
  // дата и время изменения клиента, заполняется сервером автоматически при изменении клиента
  updatedAt: '2021-02-03T13:07:29.554Z',
  // * обязательное поле, имя клиента
  name: 'Василий',
  // * обязательное поле, фамилия клиента
  surname: 'Пупкин',
  // необязательное поле, отчество клиента
  lastName: 'Васильевич',
  // контакты - необязательное поле, массив контактов
  // каждый объект в массиве (если он передан) должен содержать непустые свойства type и value
  contacts: [
    {
      type: 'Телефон',
      value: '+71234567890'
    },
    {
      type: 'Email',
      value: 'abc@xyz.com'
    },
    {
      type: 'Facebook',
      value: 'https://facebook.com/vasiliy-pupkin-the-best'
    }
  ]
}
```

## Возможные статусы ответов

Ответ сервера может содержать один из статусов ответа:
* `200` - запрос обработан нормально
* `201` - запрос на создание нового элемента успешно обработан, а заголовок ответа Location содержит ссылку на GET метод получения созданного элемента
* `404` - переданный в запросе метод не существует или запрашиваемый элемент не найден в базе данных
* `422` - объект, переданный в теле запроса, не прошёл валидацию. Тело ответа содержит массив с описаниями ошибок валидации:
  ```javascript
  [
    {
      field: 'Название поля объекта, в котором произошла ошибка',
      message: 'Сообщение об ошибке, которое можно показать пользователю'
    }
  ]
  ```